<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cbm_runner.forest_sim.forestsim_inventory &mdash; CBM_runner 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=e259d695"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            CBM_runner
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html">Example Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#plot-fluxes-for-baseline">Plot Fluxes for Baseline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CBM_runner</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cbm_runner.forest_sim.forestsim_inventory</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cbm_runner.forest_sim.forestsim_inventory</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ForestSimInventory</span>
<span class="sd">==================</span>
<span class="sd">This module contains the ForestSimInventory class, which is responsible for managing and processing inventory data for forest simulation in a CBM (Carbon Budget Modeling) context. It handles the creation and structuring of inventory data for both baseline and scenario-based simulations.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">cbm_runner.resource_manager.loader</span> <span class="kn">import</span> <span class="n">Loader</span>
<span class="kn">from</span> <span class="nn">cbm_runner.resource_manager.cbm_runner_data_manager</span> <span class="kn">import</span> <span class="n">DataManager</span>


<div class="viewcode-block" id="ForSimInventory">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory">[docs]</a>
<span class="k">class</span> <span class="nc">ForSimInventory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the inventory data for forest simulation in a CBM (Carbon Budget Modeling) context.</span>

<span class="sd">    This class is responsible for managing and processing inventory data, including legacy forest inventory and afforestation data. It handles the creation and structuring of inventory data for both baseline and scenario-based simulations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        loader_class (Loader): Instance of the Loader class for loading various data.</span>
<span class="sd">        data_manager_class (DataManager): Instance of the DataManager class for managing configuration and data retrieval.</span>
<span class="sd">        afforestation_data (dict): Data related to afforestation events.</span>
<span class="sd">        age_df (DataFrame): Data structure containing information about forest age.</span>
<span class="sd">        baseline_forest_classifiers (dict): Classifiers for the baseline forest scenario.</span>
<span class="sd">        scenario_forest_classifiers (dict): Classifiers for different scenario-based forests.</span>
<span class="sd">        legacy_year (int): The calibration year.</span>
<span class="sd">        soils_dict (dict): Dictionary containing information about different soil types.</span>
<span class="sd">        yield_baseline_dict (dict): Dictionary mapping yield classes to their respective baseline proportions nationally.</span>

<span class="sd">    Methods:</span>
<span class="sd">        legacy_forest_inventory(): Generates inventory data for legacy forests.</span>
<span class="sd">        make_inventory_structure(scenario, path, ID, delay, UNFCCCLC): Creates the structure of the inventory based on specified parameters.</span>
<span class="sd">        fill_baseline_inventory(scenario, inventory_df, forest_type, species, soil, yield_class, ageID): Fills the baseline inventory with specific data.</span>
<span class="sd">        inventory_iterator(scenario, inventory_df): Iterates over the inventory data and populates it with relevant information.</span>
<span class="sd">        afforestation_inventory(scenario, inventory_df): Generates inventory data for afforestation.</span>
<span class="sd">        scenario_afforestation_dict(scenario_afforestation_areas): Generates a dictionary for scenario-based afforestation areas.</span>
<span class="sd">        combined_mineral_afforestation_dict(scenario_afforestation_areas): Combines mineral afforestation and legacy afforestation.</span>
<span class="sd">        legacy_afforestation(): Retrieves and processes legacy afforestation data.</span>
<span class="sd">        legacy_afforestation_annual(): Processes annual legacy afforestation data.</span>
<span class="sd">        afforestation_annual_dict(afforestation_df): Converts afforestation data into an annual dictionary format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calibration_year</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">afforestation_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader_class</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span> <span class="o">=</span> <span class="n">DataManager</span><span class="p">(</span><span class="n">calibration_year</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">afforestation_data</span> <span class="o">=</span> <span class="n">afforestation_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader_class</span><span class="o">.</span><span class="n">forest_age_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_forest_classifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_classifiers</span><span class="p">()[</span>
            <span class="s2">&quot;Baseline&quot;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_forest_classifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_classifiers</span><span class="p">()[</span>
            <span class="s2">&quot;Scenario&quot;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_afforestation_baseline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soils_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_soils_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yield_baseline_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_yield_baseline_dict</span><span class="p">()</span>


<div class="viewcode-block" id="ForSimInventory.legacy_forest_inventory">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.legacy_forest_inventory">[docs]</a>
    <span class="k">def</span> <span class="nf">legacy_forest_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the legacy forest inventory data based on National Inventory Report forest data and Central Statistics Office species proportion.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: Dataframe containing the species, peat, and mineral columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">legacy_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader_class</span><span class="o">.</span><span class="n">NIR_forest_data_ha</span><span class="p">()</span>

        <span class="n">species_proportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader_class</span><span class="o">.</span><span class="n">cso_species_breakdown</span><span class="p">()</span>

        <span class="n">legacy_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_year</span>

        <span class="n">species</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Sitka&quot;</span><span class="p">:</span> <span class="s2">&quot;conifer&quot;</span><span class="p">,</span> <span class="s2">&quot;SGB&quot;</span><span class="p">:</span> <span class="s2">&quot;broadleaf&quot;</span><span class="p">}</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">,</span> <span class="s2">&quot;peat&quot;</span><span class="p">,</span> <span class="s2">&quot;mineral&quot;</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;species&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;peat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">legacy_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">legacy_year</span><span class="p">,</span> <span class="s2">&quot;organic_kha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="o">*</span> <span class="n">species_proportion</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">legacy_year</span><span class="p">,</span> <span class="n">species</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;mineral&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">legacy_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">legacy_year</span><span class="p">,</span> <span class="s2">&quot;mineral_kha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="o">*</span> <span class="n">species_proportion</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">legacy_year</span><span class="p">,</span> <span class="n">species</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="ForSimInventory.make_inventory_structure">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.make_inventory_structure">[docs]</a>
    <span class="k">def</span> <span class="nf">make_inventory_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">UNFCCCLC</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an inventory structure based on the given scenario and parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario (str): The scenario for which the inventory is being created.</span>
<span class="sd">            path (str): The path where the inventory will be saved.</span>
<span class="sd">            ID (str, optional): Fills the UsingID column, defaults to False.</span>
<span class="sd">            delay (int, optional): The delay in years for the inventory. Defaults to 0.</span>
<span class="sd">            UNFCCCLC (int, optional): The UNFCCC land class code for the inventory. Defaults to 2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: The inventory structure as a DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">age_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age_df</span>

        <span class="k">if</span> <span class="n">scenario</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario_forest_classifiers</span>
            <span class="n">classifiers_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">scenario</span><span class="p">),</span> <span class="s2">&quot;classifiers.csv&quot;</span><span class="p">)</span>
            <span class="n">forest_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_forest_type_keys</span><span class="p">()[</span><span class="s2">&quot;afforestation&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">classifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_forest_classifiers</span>
            <span class="n">classifiers_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;classifiers.csv&quot;</span><span class="p">)</span>
            <span class="n">forest_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_forest_type_keys</span><span class="p">()[</span><span class="s2">&quot;legacy&quot;</span><span class="p">]</span>

        <span class="n">yield_name_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_yield_name_dict</span><span class="p">()</span>
        <span class="n">afforestation_yield_name_dict</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_afforestation_yield_name_dict</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">non_forest_soils</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_non_forest_soils</span><span class="p">()</span>

        <span class="n">classifiers_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">classifiers_path</span><span class="p">)</span>

        <span class="n">classifiers_df</span> <span class="o">=</span> <span class="n">classifiers_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">classifiers_df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_CLASSIFIER&quot;</span><span class="p">)]</span>

        <span class="n">inventory_classifiers_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;Classifier</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">classifiers_df</span><span class="p">[</span><span class="s2">&quot;classifier_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="n">inventory_static_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;UsingID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Age&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Area&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Delay&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UNFCCCLC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HistDist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LastDist&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">inventory_cols</span> <span class="o">=</span> <span class="n">inventory_classifiers_cols</span> <span class="o">+</span> <span class="n">inventory_static_cols</span>

        <span class="n">inventory_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">inventory_cols</span><span class="p">)</span>

        <span class="n">species_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Species&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">soil_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Soil classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">yield_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Yield classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">combinations</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="n">species_keys</span><span class="p">,</span> <span class="n">forest_keys</span><span class="p">,</span> <span class="n">soil_keys</span><span class="p">,</span> <span class="n">yield_keys</span>
        <span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">soil</span><span class="p">,</span> <span class="n">yc</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">yr</span> <span class="ow">in</span> <span class="n">age_df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">yield_name_dict</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">yc</span> <span class="ow">in</span> <span class="n">yield_name_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soil</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yc</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yr</span>

                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">afforestation_yield_name_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">non_forest_soils</span><span class="p">[</span><span class="n">soil</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">yc</span> <span class="ow">in</span> <span class="n">afforestation_yield_name_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]:</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soil</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Classifier4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yc</span>
                            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;UsingID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ID</span>
            <span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Delay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delay</span>

            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">),</span> <span class="s2">&quot;UNFCCCLC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="s2">&quot;UNFCCCLC&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">UNFCCCLC</span>

        <span class="k">return</span> <span class="n">inventory_df</span></div>


<div class="viewcode-block" id="ForSimInventory.fill_baseline_inventory">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.fill_baseline_inventory">[docs]</a>
    <span class="k">def</span> <span class="nf">fill_baseline_inventory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scenario</span><span class="p">,</span>
        <span class="n">inventory_df</span><span class="p">,</span>
        <span class="n">forest_type</span><span class="p">,</span>
        <span class="n">species</span><span class="p">,</span>
        <span class="n">soil</span><span class="p">,</span>
        <span class="n">yield_class</span><span class="p">,</span>
        <span class="n">ageID</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills the baseline inventory dataframe with calculated values based on the given parameters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            scenario (str): The scenario for the inventory.</span>
<span class="sd">            inventory_df (pandas.DataFrame): The baseline inventory dataframe to be filled.</span>
<span class="sd">            forest_type (str): The forest type (L, A).</span>
<span class="sd">            species (str): The species of the forest.</span>
<span class="sd">            soil (str): The soil type.</span>
<span class="sd">            yield_class (str): The yield class.</span>
<span class="sd">            ageID (int): The age ID.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: The filled baseline inventory dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">age_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age_df</span>
        <span class="n">data_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_forest_inventory</span><span class="p">()</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">forest_type</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier3&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">soil</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier4&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yield_class</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ageID</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">species_exists</span> <span class="o">=</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">data_df</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="n">data_mask</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span>

        <span class="n">age_mask</span> <span class="o">=</span> <span class="n">age_df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ageID</span>

        <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_baseline_dict</span><span class="p">:</span>
            <span class="n">yield_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_baseline_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yield_dict</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">species_exists</span> <span class="ow">and</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">yield_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">forest_type</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
                <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;Area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">data_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_mask</span><span class="p">,</span> <span class="n">soil</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                    <span class="o">*</span> <span class="n">yield_dict</span><span class="p">[</span><span class="n">yield_class</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">age_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">age_mask</span><span class="p">,</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;HistDist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DISTID3&quot;</span>

                <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;LastDist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DISTID3&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;Area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">inventory_df</span></div>


<div class="viewcode-block" id="ForSimInventory.inventory_iterator">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.inventory_iterator">[docs]</a>
    <span class="k">def</span> <span class="nf">inventory_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">inventory_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates over different combinations of age, species, forest type, soil class, and yield class</span>
<span class="sd">        to fill the baseline inventory dataframe for a given scenario.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario (str): The scenario for which the baseline inventory is being filled.</span>
<span class="sd">            inventory_df (pandas.DataFrame): The baseline inventory dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: The updated baseline inventory dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">classifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_forest_classifiers</span>

        <span class="n">age_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age_df</span>

        <span class="c1"># Extract the keys from classifiers</span>
        <span class="n">species_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Species&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">forest_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Forest type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">soil_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Soil classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">yield_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Yield classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">combinations</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="n">age_df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">species_keys</span><span class="p">,</span> <span class="n">forest_keys</span><span class="p">,</span> <span class="n">soil_keys</span><span class="p">,</span> <span class="n">yield_keys</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">AgeID</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">forest</span><span class="p">,</span> <span class="n">soil</span><span class="p">,</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
            <span class="n">inventory_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_baseline_inventory</span><span class="p">(</span>
                <span class="n">scenario</span><span class="p">,</span>
                <span class="n">inventory_df</span><span class="p">,</span>
                <span class="n">forest</span><span class="p">,</span>
                <span class="n">species</span><span class="p">,</span>
                <span class="n">soil</span><span class="p">,</span>
                <span class="n">yield_class</span><span class="p">,</span>
                <span class="n">AgeID</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">inventory_df</span> <span class="o">=</span> <span class="n">inventory_df</span><span class="p">[</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Area&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">inventory_df</span></div>



<div class="viewcode-block" id="ForSimInventory.afforestation_inventory">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.afforestation_inventory">[docs]</a>
    <span class="k">def</span> <span class="nf">afforestation_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">inventory_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the afforestation inventory based on the given scenario and inventory dataframe.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            scenario (str): The scenario for which the afforestation inventory is calculated.</span>
<span class="sd">            inventory_df (pd.DataFrame): The inventory dataframe containing the classifier information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The updated inventory dataframe with afforestation areas calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario_forest_classifiers</span>

        <span class="n">scenario_afforestation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afforestation_data</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">scenario_afforestation_data</span><span class="p">[</span><span class="s2">&quot;scenario&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">scenario</span>

        <span class="n">afforestation_areas</span> <span class="o">=</span> <span class="n">scenario_afforestation_data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">scenario_afforestation_areas</span> <span class="o">=</span> <span class="n">afforestation_areas</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

        <span class="n">mineral_areas_dicts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combined_mineral_afforestation_dict</span><span class="p">(</span>
            <span class="n">scenario_afforestation_areas</span>
        <span class="p">)</span>
        <span class="n">legacy_afforestation_peat_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_afforestation</span><span class="p">()[</span>
            <span class="s2">&quot;peat_afforestation&quot;</span>
        <span class="p">]</span>

        <span class="n">non_forest_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_non_forest_dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Yield classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">mineral_areas_dicts</span><span class="p">[</span><span class="n">yield_class</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">soil</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">[</span><span class="s2">&quot;Soil classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">inventory_mask</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">non_forest_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">soil</span><span class="p">])</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier3&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">soil</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;Classifier4&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yield_class</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">soil</span> <span class="o">==</span> <span class="s2">&quot;peat&quot;</span><span class="p">:</span>
                        <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">inventory_mask</span><span class="p">,</span> <span class="s2">&quot;Area&quot;</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">legacy_afforestation_peat_dict</span><span class="p">[</span><span class="n">yield_class</span><span class="p">][</span><span class="n">species</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">inventory_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inventory_mask</span><span class="p">,</span> <span class="s2">&quot;Area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mineral_areas_dicts</span><span class="p">[</span>
                            <span class="n">yield_class</span>
                        <span class="p">][</span><span class="n">species</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span>

        <span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;HistDist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DISTID5&quot;</span>

        <span class="n">inventory_df</span><span class="p">[</span><span class="s2">&quot;LastDist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DISTID5&quot;</span>

        <span class="k">return</span> <span class="n">inventory_df</span></div>


<div class="viewcode-block" id="ForSimInventory.scenario_afforesation_dict">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.scenario_afforesation_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">scenario_afforesation_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_afforestation_areas</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the areas of afforestation for each yield class and species based on the scenario afforestation areas.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario_afforestation_areas (ScenarioAfforestationAreas): An object containing the species and total area of afforestation for each species.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the areas of afforestation for each yield class and species.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scenario_areas_dicts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="n">scenario_afforestation_areas</span><span class="o">.</span><span class="n">species</span><span class="p">,</span>
                <span class="n">scenario_afforestation_areas</span><span class="o">.</span><span class="n">total_area</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">areas_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">scenario_areas_dicts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_baseline_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">yield_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">areas_dict</span><span class="p">:</span>
                    <span class="n">areas_dict</span><span class="p">[</span><span class="n">yield_class</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">areas_dict</span><span class="p">[</span><span class="n">yield_class</span><span class="p">][</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scenario_areas_dicts</span><span class="p">[</span><span class="n">species</span><span class="p">]</span>
                    <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_baseline_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">yield_class</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">areas_dict</span></div>


<div class="viewcode-block" id="ForSimInventory.combined_mineral_afforestation_dict">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.combined_mineral_afforestation_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">combined_mineral_afforestation_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario_afforestation_areas</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Combines the afforestation areas from the scenario afforestation dictionary</span>
<span class="sd">        with the legacy afforestation areas for mineral afforestation.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario_afforestation_areas (dict): A dictionary containing the afforestation</span>
<span class="sd">                areas for different yield classes and species in the scenario.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the combined afforestation areas for different</span>
<span class="sd">                yield classes and species, including both scenario and legacy afforestation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scenarios_afforesation_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario_afforesation_dict</span><span class="p">(</span>
            <span class="n">scenario_afforestation_areas</span>
        <span class="p">)</span>
        <span class="n">legacy_afforestation_mineral_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_afforestation</span><span class="p">()[</span>
            <span class="s2">&quot;mineral_afforestation&quot;</span>
        <span class="p">]</span>

        <span class="n">areas_dicts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">yield_class</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">species</span><span class="p">:</span> <span class="n">scenarios_afforesation_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yield_class</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">species</span><span class="p">,</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="n">legacy_afforestation_mineral_dict</span><span class="p">[</span><span class="n">yield_class</span><span class="p">][</span><span class="n">species</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">legacy_afforestation_mineral_dict</span><span class="p">[</span><span class="n">yield_class</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">legacy_afforestation_mineral_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">areas_dicts</span></div>


<div class="viewcode-block" id="ForSimInventory.legacy_afforestation">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.legacy_afforestation">[docs]</a>
    <span class="k">def</span> <span class="nf">legacy_afforestation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the afforestation areas for legacy years.</span>

<span class="sd">        Returns a dictionary containing the sum of afforestation areas for peat and mineral soils,</span>
<span class="sd">        grouped by yield class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with the following structure:</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;peat_afforestation&quot;: {</span>
<span class="sd">                        yield_class: {</span>
<span class="sd">                            col1: sum1,</span>
<span class="sd">                            col2: sum2,</span>
<span class="sd">                            ...</span>
<span class="sd">                        },</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    &quot;mineral_afforestation&quot;: {</span>
<span class="sd">                        yield_class: {</span>
<span class="sd">                            col1: sum1,</span>
<span class="sd">                            col2: sum2,</span>
<span class="sd">                            ...</span>
<span class="sd">                        },</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">legacy_afforestation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader_class</span><span class="o">.</span><span class="n">afforestation_areas_KB</span><span class="p">()</span>

        <span class="n">soils_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soils_dict</span>
        <span class="n">legacy_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_year</span>

        <span class="n">names_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_species_name_dict</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="n">peat_afforestation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">mineral_afforestation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;=</span> <span class="n">legacy_year</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="s2">&quot;cohort&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                    <span class="n">yield_class</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">peat_mask</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;soil&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">soils_dict</span><span class="p">[</span><span class="s2">&quot;peat&quot;</span><span class="p">]))</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">count</span><span class="p">,</span> <span class="n">names_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peat_mask</span><span class="p">,</span> <span class="s2">&quot;area_ha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">mineral_mask</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;soil&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">soils_dict</span><span class="p">[</span><span class="s2">&quot;mineral&quot;</span><span class="p">]))</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">count</span><span class="p">,</span> <span class="n">names_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mineral_mask</span><span class="p">,</span> <span class="s2">&quot;area_ha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">peat_column_sums_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">yield_class</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">col</span><span class="p">:</span> <span class="n">peat_afforestation</span><span class="p">[</span>
                    <span class="n">peat_afforestation</span><span class="p">[</span><span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yield_class</span>
                <span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">peat_afforestation</span><span class="p">[</span><span class="s2">&quot;yield_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">mineral_column_sums_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">yield_class</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">col</span><span class="p">:</span> <span class="n">mineral_afforestation</span><span class="p">[</span>
                    <span class="n">mineral_afforestation</span><span class="p">[</span><span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yield_class</span>
                <span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">mineral_afforestation</span><span class="p">[</span><span class="s2">&quot;yield_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;peat_afforestation&quot;</span><span class="p">:</span> <span class="n">peat_column_sums_dict</span><span class="p">,</span>
            <span class="s2">&quot;mineral_afforestation&quot;</span><span class="p">:</span> <span class="n">mineral_column_sums_dict</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="ForSimInventory.legacy_afforestation_annual">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.legacy_afforestation_annual">[docs]</a>
    <span class="k">def</span> <span class="nf">legacy_afforestation_annual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the annual afforestation for legacy years.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the annual afforestation data for peat and mineral soils.</span>
<span class="sd">                The dictionary has the following keys:</span>
<span class="sd">                - &quot;peat_afforestation&quot;: A DataFrame containing the annual afforestation data for peat soils.</span>
<span class="sd">                - &quot;mineral_afforestation&quot;: A DataFrame containing the annual afforestation data for mineral soils.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">legacy_afforestation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader_class</span><span class="o">.</span><span class="n">afforestation_areas_KB</span><span class="p">()</span>
        <span class="n">soils_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soils_dict</span>
        <span class="n">legacy_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_year</span>

        <span class="n">names_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_manager_class</span><span class="o">.</span><span class="n">get_species_name_dict</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="n">peat_afforestation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">mineral_afforestation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;=</span> <span class="n">legacy_year</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="s2">&quot;cohort&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                    <span class="n">yield_class</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">peat_mask</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;soil&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">soils_dict</span><span class="p">[</span><span class="s2">&quot;peat&quot;</span><span class="p">]))</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">count</span><span class="p">,</span> <span class="n">names_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peat_mask</span><span class="p">,</span> <span class="s2">&quot;area_ha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">peat_afforestation</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">mineral_mask</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;soil&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">soils_dict</span><span class="p">[</span><span class="s2">&quot;mineral&quot;</span><span class="p">]))</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="p">[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">)</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">count</span><span class="p">,</span> <span class="n">names_dict</span><span class="p">[</span><span class="n">species</span><span class="p">][</span><span class="n">yield_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">legacy_afforestation_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mineral_mask</span><span class="p">,</span> <span class="s2">&quot;area_ha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="n">mineral_afforestation</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">mineral_afforestation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afforestation_annual_dict</span><span class="p">(</span><span class="n">mineral_afforestation</span><span class="p">)</span>
        <span class="n">peat_afforestation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afforestation_annual_dict</span><span class="p">(</span><span class="n">peat_afforestation</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;peat_afforestation&quot;</span><span class="p">:</span> <span class="n">peat_afforestation</span><span class="p">,</span>
            <span class="s2">&quot;mineral_afforestation&quot;</span><span class="p">:</span> <span class="n">mineral_afforestation</span><span class="p">,</span>
        <span class="p">}</span></div>



<div class="viewcode-block" id="ForSimInventory.afforestation_annual_dict">
<a class="viewcode-back" href="../../../autoapi/cbm_runner/forest_sim/forestsim_inventory/index.html#cbm_runner.forest_sim.forestsim_inventory.ForSimInventory.afforestation_annual_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">afforestation_annual_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">afforestation_df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a dictionary containing annual afforestation data.</span>

<span class="sd">        Args:</span>
<span class="sd">            afforestation_df (pandas.DataFrame): DataFrame containing afforestation data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with the following structure:</span>
<span class="sd">                {</span>
<span class="sd">                    year1: {</span>
<span class="sd">                        species1: {</span>
<span class="sd">                            yield_class1: total1,</span>
<span class="sd">                            yield_class2: total2,</span>
<span class="sd">                            ...</span>
<span class="sd">                        },</span>
<span class="sd">                        species2: {</span>
<span class="sd">                            yield_class1: total1,</span>
<span class="sd">                            yield_class2: total2,</span>
<span class="sd">                            ...</span>
<span class="sd">                        },</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    year2: {</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                }</span>
<span class="sd">            The dictionary contains the sum of afforestation values for each species and yield class</span>
<span class="sd">            for each year in the input DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">afforestation_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">year</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
            <span class="n">result_dict</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">afforestation_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                <span class="n">result_dict</span><span class="p">[</span><span class="n">year</span><span class="p">][</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">yield_class</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;yield_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;yield_class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yield_class</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">group</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>

                    <span class="n">result_dict</span><span class="p">[</span><span class="n">year</span><span class="p">][</span><span class="n">species</span><span class="p">][</span><span class="n">yield_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">species</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">result_dict</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Colm Duffy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>